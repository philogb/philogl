(function(){function v(z){return document.getElementById(z)}var F;F=null;(function(){F=function(z,x){function m(w,a,b){j.program=a;w=new F.Scene(j,a,i,c);j.scene=w;a.$$family=="program"&&a.use();e&&F.Events.create(j,v.extend(e,{bind:j}));if(d.src.length)new F.IO.Textures(j,v.extend(d,{onComplete:function(){b(j)}}));else b(j)}x=v.merge({context:{},camera:{fov:45,near:0.1,far:500},program:{from:"defaults",vs:"Default",fs:"Default"},scene:{},textures:{src:[]},events:{},onLoad:v.empty,onError:v.empty},
x||{});var n=x.context,k=x.camera,e=x.events,d=x.textures,h=v.splat(x.program),c=x.scene,f=F.WebGL.getContext(z,n);if(!f){x.onError("The WebGL context couldn't been initialized");return null}n=f.canvas;var i=new F.Camera(k.fov,k.aspect||n.width/n.height,k.near,k.far,k);i.update();var j=new F.WebGL.Application({gl:f,canvas:n,camera:i}),r={defaults:"fromDefaultShaders",ids:"fromShaderIds",sources:"fromShaderSources",uris:"fromShaderURIs"},u=h.length,q=function(){var w=u,a={},b=false;return{onSuccess:function(g,
o){a[o.id||u-w]=g;w--;if(w===0&&!b)m(f,u==1?g:a,function(p){x.onLoad(p)})},onError:function(g){w--;x.onError(g);b=true}}}();h.forEach(function(w){var a=w.from,b,g;for(g in r)if(a==g){try{w.app=j;b=F.Program[r[g]](v.extend(q,w))}catch(o){q.onError(o)}break}if(b)q.onSuccess(b,w)})}})();F.unpack=function(z){z=z||$;["Vec3","Mat4","Quat","Camera","Program","WebGL","O3D","Scene","Shaders","IO","Events","WorkerGroup","Fx","Media"].forEach(function(x){z[x]=F[x]});z.Utils=v};F.version="1.5.2";var $=this;v.empty=
function(){};v.time=Date.now;v.uid=function(){var z=v.time();return function(){return z++}}();v.extend=function(z,x){for(var m in x)z[m]=x[m];return z};v.type=function(){var z=Object.prototype.toString;return function(x){var m;m=z.call(x);m=m.substr(8,m.length-9).toLowerCase();if(m!="object")return m;if(x.$$family)return x.$$family;return x&&x.nodeName&&x.nodeType==1?"element":m}}();(function(){function z(x){var m=v.type(x);if(m=="object"){m={};for(var n in x)m[n]=z(x[n]);return m}else if(m=="array"){m=
[];n=0;for(var k=x.length;n<k;n++)m[n]=z(x[n]);return m}else return x}v.merge=function(){for(var x={},m=0,n=arguments.length;m<n;m++){var k=arguments[m];if(v.type(k)=="object")for(var e in k){var d=k[e],h=x[e];x[e]=h&&v.type(d)=="object"&&v.type(h)=="object"?v.merge(h,d):z(d)}}return x}})();v.splat=function(){var z=Array.isArray;return function(x){return z(x)&&x||[x]}}();(function(){function z(m){for(var n in m)this[n]=m[n];this.buffers={};this.bufferMemo={};this.frameBuffers={};this.frameBufferMemo=
{};this.renderBuffers={};this.renderBufferMemo={};this.textures={};this.textureMemo={}}var x={getContext:function(m,n){m=typeof m=="string"?v(m):m;var k;(k=m.getContext("experimental-webgl",n))||(k=m.getContext("webgl",n));var e;if(k&&n&&n.debug){e={};for(var d in k){var h=k[d];e[d]=typeof h=="function"?function(c,f){return function(){console.log(c,Array.prototype.join.call(arguments),Array.prototype.slice.call(arguments));try{var i=f.apply(k,arguments)}catch(j){throw c+" "+j;}for(var r=[],u;(u=k.getError())!==
k.NO_ERROR;)r.push(u);if(r.length)throw r.join();return i}}(d,h):h}}else e=k;if(e)e.get=function(c){return typeof c=="string"?e[c]:c};return e}};z.prototype={$$family:"application",setBuffer:function(m,n,k){if(k===false||k===null){(k=this.bufferMemo[n])&&this.gl.bindBuffer(k.bufferType,null);var e=k&&k.attribute||n;m=m.attributes[e];m!==undefined&&this.gl.disableVertexAttribArray(m)}else{k=v.extend(this.bufferMemo[n]||{bufferType:this.gl.ARRAY_BUFFER,size:1,dataType:this.gl.FLOAT,stride:0,offset:0,
drawType:this.gl.STATIC_DRAW,instanced:0},k||{});e=k.attribute||n;var d=k.bufferType,h=k.instanced,c=n in this.buffers,f=c?this.buffers[n]:this.gl.createBuffer(),i="value"in k,j=k.value,r=k.size,u=k.dataType,q=k.stride,w=k.offset,a=k.drawType;m=m.attributes[e];var b=m!==undefined;c||(this.buffers[n]=f);b&&this.gl.enableVertexAttribArray(m);this.gl.bindBuffer(d,f);i&&this.gl.bufferData(d,j,a);if(b){this.gl.vertexAttribPointer(m,r,u,false,q,w);if(h)(d=this.gl.getExtension("ANGLE_instanced_arrays"))?
d.vertexAttribDivisorANGLE(m,h===true?1:h):console.warn("ANGLE_instanced_arrays not supported!")}delete k.value;this.bufferMemo[n]=k;if(b)this.bufferMemo[e]=k;return this}},setBuffers:function(m,n){for(var k in n)this.setBuffer(m,k,n[k]);return this},setFrameBuffer:function(m,n){if(typeof n!="object")this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,n?this.frameBuffers[m]:null);else{n=v.merge(this.frameBufferMemo[m]||{width:0,height:0,bindToTexture:false,textureOptions:{attachment:this.gl.COLOR_ATTACHMENT0},
bindToRenderBuffer:false,renderBufferOptions:{attachment:this.gl.DEPTH_ATTACHMENT}},n||{});var k=n.bindToTexture,e=n.bindToRenderBuffer,d=m in this.frameBuffers,h=d?this.frameBuffers[m]:this.gl.createFramebuffer();this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,h);d||(this.frameBuffers[m]=h);if(k){k=v.merge({data:{width:n.width,height:n.height}},v.type(k)=="object"?k:{});d=m+"-texture";h=n.textureOptions;this.setTexture(d,k);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,h.attachment,this.textureMemo[d].textureType,
this.textures[d],0)}if(e){e=v.extend({width:n.width,height:n.height},v.type(e)=="object"?e:{});k=m+"-renderbuffer";d=n.renderBufferOptions;this.setRenderBuffer(k,e);this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,d.attachment,this.gl.RENDERBUFFER,this.renderBuffers[k])}this.gl.bindTexture(this.gl.TEXTURE_2D,null);this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);this.frameBufferMemo[m]=n;return this}},setFrameBuffers:function(m){for(var n in m)this.setFrameBuffer(n,
m[n]);return this},setRenderBuffer:function(m,n){if(typeof n!="object")this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,n?this.renderBufferMemo[m]:null);else{n=v.extend(this.renderBufferMemo[m]||{storageType:this.gl.DEPTH_COMPONENT16,width:0,height:0},n||{});var k=m in this.renderBuffers,e=k?this.renderBuffers[m]:this.gl.createRenderbuffer(this.gl.RENDERBUFFER);k||(this.renderBuffers[m]=e);this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,e);this.gl.renderbufferStorage(this.gl.RENDERBUFFER,n.storageType,
n.width,n.height);this.renderBufferMemo[m]=n;return this}},setRenderBuffers:function(m){for(var n in m)this.setRenderBuffer(n,m[n]);return this},setTexture:function(m,n){if(!n||typeof n!="object"){this.gl.activeTexture(n||this.gl.TEXTURE0);this.gl.bindTexture(this.textureMemo[m].textureType||this.gl.TEXTURE_2D,this.textures[m])}else{if(n.data&&n.data.type===this.gl.FLOAT)if(!this.gl.getExtension("OES_texture_float"))throw"OES_texture_float is not supported";n=v.merge(this.textureMemo[m]||{textureType:this.gl.TEXTURE_2D,
pixelStore:[{name:this.gl.UNPACK_FLIP_Y_WEBGL,value:true},{name:this.gl.UNPACK_ALIGNMENT,value:1}],parameters:[{name:this.gl.TEXTURE_MAG_FILTER,value:this.gl.NEAREST},{name:this.gl.TEXTURE_MIN_FILTER,value:this.gl.NEAREST},{name:this.gl.TEXTURE_WRAP_S,value:this.gl.CLAMP_TO_EDGE},{name:this.gl.TEXTURE_WRAP_T,value:this.gl.CLAMP_TO_EDGE}],data:{format:this.gl.RGBA,value:false,type:this.gl.UNSIGNED_BYTE,width:0,height:0,border:0}},n||{});var k="textureType"in n?n.textureType=this.gl.get(n.textureType):
this.gl.TEXTURE_2D,e="textureTarget"in n?n.textureTarget=this.gl.get(n.textureTarget):k,d=k==this.gl.TEXTURE_CUBE_MAP,h=m in this.textures,c=h?this.textures[m]:this.gl.createTexture(),f=n.pixelStore,i=n.parameters,j=n.data,r=j.value,u=j.type,q=j.format,w=!!j.value;h||(this.textures[m]=c);this.gl.bindTexture(k,c);h||f.forEach(function(a){a.name=typeof a.name=="string"?this.gl.get(a.name):a.name;this.gl.pixelStorei(a.name,a.value)}.bind(this));if(w)if(d)for(c=0;c<6;++c)(j.width||j.height)&&!r.width&&
!r.height?this.gl.texImage2D(e[c],0,q,j.width,j.height,j.border,q,u,r[c]):this.gl.texImage2D(e[c],0,q,q,u,r[c]);else(j.width||j.height)&&!r.width&&!r.height?this.gl.texImage2D(e,0,q,j.width,j.height,j.border,q,u,r):this.gl.texImage2D(e,0,q,q,u,r);else if(j.width||j.height)this.gl.texImage2D(e,0,q,j.width,j.height,j.border,q,u,null);if(!h)for(c=0;c<i.length;c++){e=i[c];e.name=this.gl.get(e.name);e.value=this.gl.get(e.value);this.gl.texParameteri(k,e.name,e.value);e.generateMipmap&&this.gl.generateMipmap(k)}n.isCube=
d;if(w)n.data.value=false;this.textureMemo[m]=n;return this}},setTextures:function(m){for(var n in m)this.setTexture(n,m[n]);return this},use:function(m){this.gl.useProgram(m.program);this.usedProgram=m;return this}};x.Application=z;(function(){try{var m=document.createElement("canvas");F.hasWebGL=function(){return!!(window.WebGLRenderingContext&&(m.getContext("webgl")||m.getContext("experimental-webgl")))}}catch(n){F.hasWebGL=function(){return false}}F.hasExtension=function(k){if(!F.hasWebGL())return false;
var e=document.createElement("canvas");return(e.getContext("webgl")||e.getContext("experimental-webgl")).getExtension(k)}})();F.WebGL=x})();(function(){function z(a){return{get:function(){return this[a]},set:function(b){this[a]=b},configurable:false,enumerable:false}}var x=Math.sqrt,m=Math.sin,n=Math.cos,k=Math.tan,e=Math.PI,d=Array.prototype.slice,h=this.Float32Array,c=function(){if(!h||!h.call)return Array;try{h.call({},10)}catch(a){return Array}return h}(),f=c!=Array,i=function(a,b,g){if(f){h.call(this,
3);this[0]=a||0;this[1]=b||0;this[2]=g||0}else this.push(a||0,b||0,g||0);this.typedContainer=new h(3)};i.create=function(){return new h(3)};i.prototype=Object.create(c.prototype,{$$family:{value:"Vec3"},x:z(0),y:z(1),z:z(2)});var j={setVec3:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,g,o){a[0]=b;a[1]=g;a[2]=o;return a},add:function(a,b){return new i(a[0]+b[0],a[1]+b[1],a[2]+b[2])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];return a},add2:function(a,b,g){a[0]=b[0]+
g[0];a[1]=b[1]+g[1];a[2]=b[2]+g[2];return a},sub:function(a,b){return new i(a[0]-b[0],a[1]-b[1],a[2]-b[2])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];return a},sub2:function(a,b,g){a[0]=b[0]-g[0];a[1]=b[1]-g[1];a[2]=b[2]-g[2];return a},scale:function(a,b){return new i(a[0]*b,a[1]*b,a[2]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;return a},neg:function(a){return new i(-a[0],-a[1],-a[2])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a},unit:function(a){var b=i.norm(a);if(b>
0)return i.scale(a,1/b);return i.clone(a)},$unit:function(a){var b=i.norm(a);if(b>0)return i.$scale(a,1/b);return a},cross:function(a,b){var g=a[0],o=a[1],p=a[2],s=b[0],t=b[1],y=b[2];return new i(o*y-p*t,p*s-g*y,g*t-o*s)},$cross:function(a,b){var g=a[0],o=a[1],p=a[2],s=b[0],t=b[1],y=b[2];a[0]=o*y-p*t;a[1]=p*s-g*y;a[2]=g*t-o*s;return a},distTo:function(a,b){var g=a[0]-b[0],o=a[1]-b[1],p=a[2]-b[2];return x(g*g+o*o+p*p)},distToSq:function(a,b){var g=a[0]-b[0],o=a[1]-b[1],p=a[2]-b[2];return g*g+o*o+p*
p},norm:function(a){var b=a[0],g=a[1];a=a[2];return x(b*b+g*g+a*a)},normSq:function(a){var b=a[0],g=a[1];a=a[2];return b*b+g*g+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},clone:function(a){return a.$$family?new i(a[0],a[1],a[2]):i.setVec3(new h(3),a)},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];return b}},r=i.prototype,u;for(u in j){i[u]=j[u];r[u]=function(a){return function(){var b=d.call(arguments);b.unshift(this);return i[a].apply(i,
b)}}(u)}var q=function(a,b,g,o,p,s,t,y,A,B,C,D,G,H,K,I){c.call(this,16);this.length=16;typeof a=="number"?this.set(a,b,g,o,p,s,t,y,A,B,C,D,G,H,K,I):this.id();this.typedContainer=new h(16)};q.create=function(){return new h(16)};q.prototype=Object.create(c.prototype,{$$family:{value:"Mat4"},n11:z(0),n12:z(4),n13:z(8),n14:z(12),n21:z(1),n22:z(5),n23:z(9),n24:z(13),n31:z(2),n32:z(6),n33:z(10),n34:z(14),n41:z(3),n42:z(7),n43:z(11),n44:z(15)});j={id:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;
a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){return a.$$family?new q(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]):new h(a)},set:function(a,b,g,o,p,s,t,y,A,B,C,D,G,H,K,I,E){a[0]=b;a[4]=g;a[8]=o;a[12]=p;a[1]=s;a[5]=t;a[9]=y;a[13]=A;a[2]=B;a[6]=C;a[10]=D;a[14]=G;a[3]=H;a[7]=K;a[11]=I;a[15]=E;return a},mulVec3:function(a,b){var g=i.clone(b);return q.$mulVec3(a,g)},$mulVec3:function(a,b){var g=b[0],o=b[1],
p=b[2],s=1/(a[3]*g+a[7]*o+a[11]*p+a[15]);b[0]=(a[0]*g+a[4]*o+a[8]*p+a[12])*s;b[1]=(a[1]*g+a[5]*o+a[9]*p+a[13])*s;b[2]=(a[2]*g+a[6]*o+a[10]*p+a[14])*s;return b},mulMat42:function(a,b,g){var o=b[0],p=b[1],s=b[2],t=b[3],y=b[4],A=b[5],B=b[6],C=b[7],D=b[8],G=b[9],H=b[10],K=b[11],I=b[12],E=b[13],M=b[14];b=b[15];var J=g[0],L=g[1],O=g[2],P=g[3],R=g[4],Q=g[5],V=g[6],S=g[7],T=g[8],W=g[9],U=g[10],N=g[11],X=g[12],Y=g[13],Z=g[14];g=g[15];a[0]=J*o+L*y+O*D+P*I;a[1]=J*p+L*A+O*G+P*E;a[2]=J*s+L*B+O*H+P*M;a[3]=J*t+
L*C+O*K+P*b;a[4]=R*o+Q*y+V*D+S*I;a[5]=R*p+Q*A+V*G+S*E;a[6]=R*s+Q*B+V*H+S*M;a[7]=R*t+Q*C+V*K+S*b;a[8]=T*o+W*y+U*D+N*I;a[9]=T*p+W*A+U*G+N*E;a[10]=T*s+W*B+U*H+N*M;a[11]=T*t+W*C+U*K+N*b;a[12]=X*o+Y*y+Z*D+g*I;a[13]=X*p+Y*A+Z*G+g*E;a[14]=X*s+Y*B+Z*H+g*M;a[15]=X*t+Y*C+Z*K+g*b;return a},mulMat4:function(a,b){var g=q.clone(a);return q.mulMat42(g,a,b)},$mulMat4:function(a,b){return q.mulMat42(a,a,b)},add:function(a,b){var g=q.clone(a);return q.$add(g,b)},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];
a[3]+=b[3];a[4]+=b[4];a[5]+=b[5];a[6]+=b[6];a[7]+=b[7];a[8]+=b[8];a[9]+=b[9];a[10]+=b[10];a[11]+=b[11];a[12]+=b[12];a[13]+=b[13];a[14]+=b[14];a[15]+=b[15];return a},transpose:function(a){a=q.clone(a);return q.$transpose(a)},$transpose:function(a){var b=a[8],g=a[12],o=a[1],p=a[9],s=a[13],t=a[2],y=a[6],A=a[14],B=a[3],C=a[7],D=a[11];a[1]=a[4];a[2]=b;a[3]=g;a[4]=o;a[6]=p;a[7]=s;a[8]=t;a[9]=y;a[11]=A;a[12]=B;a[13]=C;a[14]=D;return a},rotateAxis:function(a,b,g){a=q.clone(a);return q.$rotateAxis(a,b,g)},
$rotateAxis:function(a,b,g){var o=m(b),p=n(b),s=1-p,t=g[0],y=g[1],A=g[2];g=t*t*s+p;b=t*y*s+A*o;var B=t*A*s-y*o,C=y*t*s-A*o,D=y*y*s+p,G=y*A*s+t*o,H=t*A*s+y*o;o=y*A*s-t*o;p=A*A*s+p;s=a[0];t=a[1];y=a[2];A=a[3];var K=a[4],I=a[5],E=a[6],M=a[7],J=a[8],L=a[9],O=a[10],P=a[11];a[0]=s*g+K*b+J*B;a[1]=t*g+I*b+L*B;a[2]=y*g+E*b+O*B;a[3]=A*g+M*b+P*B;a[4]=s*C+K*D+J*G;a[5]=t*C+I*D+L*G;a[6]=y*C+E*D+O*G;a[7]=A*C+M*D+P*G;a[8]=s*H+K*o+J*p;a[9]=t*H+I*o+L*p;a[10]=y*H+E*o+O*p;a[11]=A*H+M*o+P*p;return a},rotateXYZ:function(a,
b,g,o){a=q.clone(a);return q.$rotateXYZ(a,b,g,o)},$rotateXYZ:function(a,b,g,o){var p=a[0],s=a[1],t=a[2],y=a[3],A=a[4],B=a[5],C=a[6],D=a[7],G=a[8],H=a[9],K=a[10],I=a[11],E=n(b),M=n(g),J=n(o);b=m(b);var L=m(g),O=m(o);o=M*J;g=-E*O+b*L*J;var P=b*O+E*L*J,R=M*O,Q=E*J+b*L*O;J=-b*J+E*L*O;L=-L;b*=M;E*=M;a[0]=p*o+A*R+G*L;a[1]=s*o+B*R+H*L;a[2]=t*o+C*R+K*L;a[3]=y*o+D*R+I*L;a[4]=p*g+A*Q+G*b;a[5]=s*g+B*Q+H*b;a[6]=t*g+C*Q+K*b;a[7]=y*g+D*Q+I*b;a[8]=p*P+A*J+G*E;a[9]=s*P+B*J+H*E;a[10]=t*P+C*J+K*E;a[11]=y*P+D*J+I*E;
return a},translate:function(a,b,g,o){a=q.clone(a);return q.$translate(a,b,g,o)},$translate:function(a,b,g,o){a[12]=a[0]*b+a[4]*g+a[8]*o+a[12];a[13]=a[1]*b+a[5]*g+a[9]*o+a[13];a[14]=a[2]*b+a[6]*g+a[10]*o+a[14];a[15]=a[3]*b+a[7]*g+a[11]*o+a[15];return a},scale:function(a,b,g,o){a=q.clone(a);return q.$scale(a,b,g,o)},$scale:function(a,b,g,o){a[0]*=b;a[1]*=b;a[2]*=b;a[3]*=b;a[4]*=g;a[5]*=g;a[6]*=g;a[7]*=g;a[8]*=o;a[9]*=o;a[10]*=o;a[11]*=o;return a},invert:function(a){a=q.clone(a);return q.$invert(a)},
$invert:function(a){var b=a[0],g=a[1],o=a[2],p=a[3],s=a[4],t=a[5],y=a[6],A=a[7],B=a[8],C=a[9],D=a[10],G=a[11],H=a[12],K=a[13],I=a[14],E=a[15],M=b*t-g*s,J=b*y-o*s,L=b*A-p*s,O=g*y-o*t,P=g*A-p*t,R=o*A-p*y,Q=B*K-C*H,V=B*I-D*H,S=B*E-G*H,T=C*I-D*K,W=C*E-G*K,U=D*E-G*I,N=1/(M*U-J*W+L*T+O*S-P*V+R*Q);a[0]=(+t*U-y*W+A*T)*N;a[1]=(-g*U+o*W-p*T)*N;a[2]=(+K*R-I*P+E*O)*N;a[3]=(-C*R+D*P-G*O)*N;a[4]=(-s*U+y*S-A*V)*N;a[5]=(+b*U-o*S+p*V)*N;a[6]=(-H*R+I*L-E*J)*N;a[7]=(+B*R-D*L+G*J)*N;a[8]=(+s*W-t*S+A*Q)*N;a[9]=(-b*W+
g*S-p*Q)*N;a[10]=(+H*P-K*L+E*M)*N;a[11]=(-B*P+C*L-G*M)*N;a[12]=(-s*T+t*V-y*Q)*N;a[13]=(+b*T-g*V+o*Q)*N;a[14]=(-H*O+K*J-I*M)*N;a[15]=(+B*O-C*J+D*M)*N;return a},lookAt:function(a,b,g,o){g=i.sub(b,g);g.$unit();o=i.cross(o,g);o.$unit();var p=i.cross(g,o);p.$unit();return q.set(a,o[0],o[1],o[2],-o.dot(b),p[0],p[1],p[2],-p.dot(b),g[0],g[1],g[2],-g.dot(b),0,0,0,1)},frustum:function(a,b,g,o,p,s,t){var y=g-b,A=p-o,B=t-s;a[0]=s*2/y;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=s*2/A;a[6]=0;a[7]=0;a[8]=(g+b)/y;a[9]=(p+o)/
A;a[10]=-(t+s)/B;a[11]=-1;a[12]=0;a[13]=0;a[14]=-(t*s*2)/B;a[15]=0;return a},perspective:function(a,b,g,o,p){b=o*k(b*e/360);var s=-b;return q.frustum(a,s*g,b*g,s,b,o,p)},ortho:function(a,b,g,o,p,s,t){var y=g-b,A=o-p,B=t-s;a[0]=2/y;a[4]=0;a[8]=0;a[12]=-((g+b)/y);a[1]=0;a[5]=2/A;a[9]=0;a[13]=-((o+p)/A);a[2]=0;a[6]=0;a[10]=-2/B;a[14]=-((t+s)/B);a[3]=0;a[7]=0;a[11]=0;a[15]=1;return a},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=
a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b}};r=q.prototype;for(u in j){q[u]=j[u];r[u]=function(a){return function(){var b=d.call(arguments);b.unshift(this);return q[a].apply(q,b)}}(u)}var w=function(a,b,g,o){c.call(this,4);this[0]=a||0;this[1]=b||0;this[2]=g||0;this[3]=o||0;this.typedContainer=new h(4)};w.create=function(){return new h(4)};j={setQuat:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,
b,g,o,p){a[0]=b||0;a[1]=g||0;a[2]=o||0;a[3]=p||0;return a},clone:function(a){return a.$$family?new w(a[0],a[1],a[2],a[3]):w.setQuat(new h(4),a)},neg:function(a){return new w(-a[0],-a[1],-a[2],-a[3])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];a[3]=-a[3];return a},add:function(a,b){return new w(a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];a[3]+=b[3];return a},sub:function(a,b){return new w(a[0]-b[0],a[1]-b[1],a[2]-b[2],a[3]-b[3])},$sub:function(a,
b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];a[3]-=b[3];return a},scale:function(a,b){return new w(a[0]*b,a[1]*b,a[2]*b,a[3]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;a[3]*=b;return a},mulQuat:function(a,b){var g=a[0],o=a[1],p=a[2],s=a[3],t=b[0],y=b[1],A=b[2],B=b[3];return new w(s*t+g*B+o*A-p*y,s*y+o*B+p*t-g*A,s*A+p*B+g*y-o*t,s*B-g*t-o*y-p*A)},$mulQuat:function(a,b){var g=a[0],o=a[1],p=a[2],s=a[3],t=b[0],y=b[1],A=b[2],B=b[3];a[0]=s*t+g*B+o*A-p*y;a[1]=s*y+o*B+p*t-g*A;a[2]=s*A+p*B+g*y-o*t;a[3]=s*B-g*
t-o*y-p*A;return a},divQuat:function(a,b){var g=a[0],o=a[1],p=a[2],s=a[3],t=b[0],y=b[1],A=b[2],B=b[3],C=1/(B*B+t*t+y*y+A*A);return new w((g*B-s*t-o*A+p*y)*C,(g*A-s*y+o*B-p*t)*C,(o*t+p*B-s*A-g*y)*C,(s*B+g*t+o*y+p*A)*C)},$divQuat:function(a,b){var g=a[0],o=a[1],p=a[2],s=a[3],t=b[0],y=b[1],A=b[2],B=b[3],C=1/(B*B+t*t+y*y+A*A);a[0]=(g*B-s*t-o*A+p*y)*C;a[1]=(g*A-s*y+o*B-p*t)*C;a[2]=(o*t+p*B-s*A-g*y)*C;a[3]=(s*B+g*t+o*y+p*A)*C;return a},invert:function(a){var b=a[0],g=a[1],o=a[2];a=a[3];var p=1/(b*b+g*g+
o*o+a*a);return new w(-b*p,-g*p,-o*p,a*p)},$invert:function(a){var b=a[0],g=a[1],o=a[2],p=a[3],s=1/(b*b+g*g+o*o+p*p);a[0]=-b*s;a[1]=-g*s;a[2]=-o*s;a[3]=p*s;return a},norm:function(a){var b=a[0],g=a[1],o=a[2];a=a[3];return x(b*b+g*g+o*o+a*a)},normSq:function(a){var b=a[0],g=a[1],o=a[2];a=a[3];return b*b+g*g+o*o+a*a},unit:function(a){return w.scale(a,1/w.norm(a))},$unit:function(a){return w.$scale(a,1/w.norm(a))},conjugate:function(a){return new w(-a[0],-a[1],-a[2],a[3])},$conjugate:function(a){a[0]=
-a[0];a[1]=-a[1];a[2]=-a[2];return a}};r=w.prototype={};for(u in j){w[u]=j[u];r[u]=function(a){return function(){var b=d.call(arguments);b.unshift(this);return w[a].apply(w,b)}}(u)}i.fromQuat=function(a){return new i(a[0],a[1],a[2])};w.fromVec3=function(a,b){return new w(a[0],a[1],a[2],b||0)};w.fromMat4=function(a){var b,g,o;if(a[0]>a[5]&&a[0]>a[10]){b=0;g=1;o=2}else if(a[5]>a[0]&&a[5]>a[10]){b=1;g=2;o=0}else{b=2;g=0;o=1}var p=x(1+a[b*5]-a[g*5]-a[o*5]),s=new w;s[b]=0.5*p;s[g]=0.5*(a["n"+g+""+b]+a["n"+
b+""+g])/p;s[o]=0.5*(a["n"+b+""+o]+a["n"+o+""+b])/p;s[3]=0.5*(a["n"+g+""+o]-a["n"+o+""+g])/p;return s};w.fromXRotation=function(a){return new w(m(a/2),0,0,n(a/2))};w.fromYRotation=function(a){return new w(0,m(a/2),0,n(a/2))};w.fromZRotation=function(a){return new w(0,0,m(a/2),n(a/2))};w.fromAxisRotation=function(a,b){var g=a[0],o=a[1],p=a[2],s=1/x(g*g+o*o+p*p),t=m(b/2),y=n(b/2);return new w(t*g*s,t*o*s,t*p*s,y)};q.fromQuat=function(a){var b=a[3],g=a[0],o=a[1];a=a[2];return new q(b*b+g*g-o*o-a*a,2*
g*o-2*b*a,2*g*a+2*b*o,0,2*g*o+2*b*a,b*b-g*g+o*o-a*a,2*o*a-2*b*g,0,2*g*a-2*b*o,2*o*a+2*b*g,b*b-g*g-o*o+a*a,0,0,0,0,1)};F.Vec3=i;F.Mat4=q;F.Quat=w})();(function(){function z(e){return e!==true?e:false}var x=function(e){e=e.getBoundingClientRect();return{x:e.left,y:e.top,bbox:e}},m={get:function(e,d){return e||(d||window).event},getWheel:function(e){return e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3},getKey:function(e){var d=e.which||e.keyCode,h;a:{h=k.Keys;for(var c in h)if(h[c]==d){h=c;break a}h=
void 0}c=d-111;if(c>0&&c<13)h="f"+c;h=h||String.fromCharCode(d).toLowerCase();return{code:d,key:h,shift:e.shiftKey,control:e.ctrlKey,alt:e.altKey,meta:e.metaKey}},isRightClick:function(e){return e.which==3||e.button==2},getPos:function(e,d){d=d||window;e=e||d.event;var h=d.document,c;h=h.documentElement||h.body;if(e.touches&&e.touches.length){c=[];for(var f=0,i=e.touches.length,j;f<i;++f){j=e.touches[f];c.push({x:j.pageX||j.clientX+h.scrollLeft,y:j.pageY||j.clientY+h.scrollTop})}return c}return[{x:e.pageX||
e.clientX+h.scrollLeft,y:e.pageY||e.clientY+h.scrollTop}]},stop:function(e){e.stopPropagation&&e.stopPropagation();e.cancelBubble=true;if(e.preventDefault)e.preventDefault();else e.returnValue=false}},n=function(e,d){var h=e.canvas;this.scene=e.scene;this.domElem=h;this.pos=x(h);this.opt=this.callbacks=d;this.size={width:h.width||h.offsetWidth,height:h.height||h.offsetHeight};this.attachEvents()};n.prototype={hovered:false,pressed:false,touched:false,touchedLastPosition:{x:0,y:0},touchMoved:false,
moved:false,attachEvents:function(){var e=this.domElem,d=this.opt,h=this;if(d.disableContextMenu)e.oncontextmenu=function(){return false};if(d.enableMouse){["mouseup","mousedown","mousemove","mouseover","mouseout"].forEach(function(f){e.addEventListener(f,function(i,j){h[f](h.eventInfo(f,i,j))},false)});var c="";c=!document.getBoxObjectFor&&window.mozInnerScreenX==null?"mousewheel":"DOMMouseScroll";e.addEventListener(c,function(f,i){h.mousewheel(h.eventInfo("mousewheel",f,i))},false)}d.enableTouch&&
["touchstart","touchmove","touchend"].forEach(function(f){e.addEventListener(f,function(i,j){h[f](h.eventInfo(f,i,j))},false)});d.enableKeyboard&&["keydown","keyup"].forEach(function(f){document.addEventListener(f,function(i,j){h[f](h.eventInfo(f,i,j))},false)})},eventInfo:function(e,d,h){var c=this.domElem,f=this.scene,i=this.opt,j=this.getSize(),r=i.relative,u=i.centerOrigin,q=i.cachePosition&&this.pos||x(c),w=m.get(d,h);d=m.getPos(d,h);var a={x:d[0].x,y:d[0].y};h={};for(var b,g=0,o=d.length;g<
o;++g){c=d[g].x;b=d[g].y;if(r){c-=q.x;b-=q.y;if(u){c-=j.width/2;b-=j.height/2;b*=-1}}d[g].x=c;d[g].y=b}switch(e){case "mousewheel":h.wheel=m.getWheel(w);break;case "keydown":case "keyup":v.extend(h,m.getKey(w));break;case "mouseup":h.isRightClick=m.isRightClick(w)}var p;v.extend(h,{x:d[0].x,y:d[0].y,posArray:d,cache:false,stop:function(){m.stop(w)},getTarget:function(){if(p)return p;return p=i.picking&&f.pick(a.x-q.x,a.y-q.y)||true}});h.event=w;return h},getSize:function(){if(this.cacheSize)return this.size;
var e=this.domElem;return{width:e.width||e.offsetWidth,height:e.height||e.offsetHeight}},mouseup:function(e){if(!this.moved)if(e.isRightClick)this.callbacks.onRightClick(e,this.hovered);else this.callbacks.onClick(e,z(this.pressed));if(this.pressed){if(this.moved)this.callbacks.onDragEnd(e,z(this.pressed));else this.callbacks.onDragCancel(e,z(this.pressed));this.pressed=this.moved=false}},mouseout:function(e){for(var d=e.relatedTarget,h=this.domElem;d&&d.parentNode;){if(h==d.parentNode)return;d=d.parentNode}if(this.hovered){this.callbacks.onMouseLeave(e,
this.hovered);this.hovered=false}if(this.pressed&&this.moved){this.callbacks.onDragEnd(e);this.pressed=this.moved=false}},mouseover:function(){},mousemove:function(e){if(this.pressed){this.moved=true;this.callbacks.onDragMove(e,z(this.pressed))}else{if(this.hovered){var d=z(e.getTarget());if(!d||d.hash!=this.hash){this.callbacks.onMouseLeave(e,this.hovered);if(this.hash=this.hovered=d){this.hash=d.hash;this.callbacks.onMouseEnter(e,this.hovered)}}else this.callbacks.onMouseMove(e,this.hovered)}else if(this.hash=
this.hovered=z(e.getTarget())){this.hash=this.hovered.hash;this.callbacks.onMouseEnter(e,this.hovered)}if(!this.opt.picking)this.callbacks.onMouseMove(e)}},mousewheel:function(e){this.callbacks.onMouseWheel(e)},mousedown:function(e){this.pressed=e.getTarget();this.callbacks.onDragStart(e,z(this.pressed))},touchstart:function(e){this.touched=e.getTarget();this.touchedLastPosition={x:e.x,y:e.y};this.callbacks.onTouchStart(e,z(this.touched))},touchmove:function(e){if(this.touched){this.touchMoved=true;
this.callbacks.onTouchMove(e,z(this.touched))}},touchend:function(e){if(this.touched){if(this.touchMoved)this.callbacks.onTouchEnd(e,z(this.touched));else{e.x=isNaN(e.x)?this.touchedLastPosition.x:e.x;e.y=isNaN(e.y)?this.touchedLastPosition.y:e.y;this.callbacks.onTap(e,z(this.touched));this.callbacks.onTouchCancel(e,z(this.touched))}this.touched=this.touchMoved=false}},keydown:function(e){this.callbacks.onKeyDown(e)},keyup:function(e){this.callbacks.onKeyUp(e)}};var k={};k.create=function(e,d){d=
v.extend({cachePosition:true,cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,picking:false,lazyPicking:false,enableTouch:true,enableMouse:true,enableKeyboard:true,onClick:v.empty,onRightClick:v.empty,onDragStart:v.empty,onDragMove:v.empty,onDragEnd:v.empty,onDragCancel:v.empty,onTouchStart:v.empty,onTouchMove:v.empty,onTouchEnd:v.empty,onTouchCancel:v.empty,onTap:v.empty,onMouseMove:v.empty,onMouseEnter:v.empty,onMouseLeave:v.empty,onMouseWheel:v.empty,onKeyDown:v.empty,
onKeyUp:v.empty},d||{});var h=d.bind;if(h)for(var c in d)c.match(/^on[a-zA-Z0-9]+$/)&&function(f,i){d[f]=function(){return i.apply(h,Array.prototype.slice.call(arguments))}}(c,d[c]);new n(e,d);e.events=d};k.Keys={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};F.Events=k})();(function(){function z(d,h){return v.merge(h||{},d.length==2?{vs:d[0],fs:d[1]}:d[0]||{})}var x=function(d,h,c){var f=d.createShader(c);if(f==null)throw"Error creating the shader with shader type: "+
c;d.shaderSource(f,h);d.compileShader(f);if(!d.getShaderParameter(f,d.COMPILE_STATUS)){h=d.getShaderInfoLog(f);d.deleteShader(f);throw"Error while compiling the shader "+h;}return f},m=function(d){var h=d.lastIndexOf("/");return h=="/"?"./":d.substr(0,h+1)},n=function(d,h,c,f,i,j){j=j||{};var r;if(r=c.match(/#include "(.*?)"/)){var u=F.IO.XHR,q=m(h)+r[1];j[q]&&i("Recursive include");(new u({url:q,noCache:true,onError:function(w){i("Load included file `"+q+"` failed: Code "+w)},onSuccess:function(w){j[q]=
true;return n(d,q,w,function(a){delete j[q];c=c.replace(/#include ".*?"/,a);c=c.replace(/\sHAS_EXTENSION\s*\(\s*([A-Za-z_\-0-9]+)\s*\)/g,function(b,g){return d.getExtension(g)?" 1 ":" 0 "});return n(d,q,c,f,i,j)},i,j)}})).send();return null}else return f(c)},k=function(d,h,c,f){var i=d.getUniformLocation(h,c.name);h=c.type;var j=false,r=true,u,q;if(c.size>1&&f)switch(h){case d.FLOAT:u=d.uniform1fv;q=Float32Array;r=false;break;case d.INT:case d.BOOL:case d.SAMPLER_2D:case d.SAMPLER_CUBE:u=d.uniform1iv;
q=Uint16Array;r=false}if(r)switch(h){case d.FLOAT:u=d.uniform1f;break;case d.FLOAT_VEC2:u=d.uniform2fv;q=f?Float32Array:new Float32Array(2);break;case d.FLOAT_VEC3:u=d.uniform3fv;q=f?Float32Array:new Float32Array(3);break;case d.FLOAT_VEC4:u=d.uniform4fv;q=f?Float32Array:new Float32Array(4);break;case d.INT:case d.BOOL:case d.SAMPLER_2D:case d.SAMPLER_CUBE:u=d.uniform1i;break;case d.INT_VEC2:case d.BOOL_VEC2:u=d.uniform2iv;q=f?Uint16Array:new Uint16Array(2);break;case d.INT_VEC3:case d.BOOL_VEC3:u=
d.uniform3iv;q=f?Uint16Array:new Uint16Array(3);break;case d.INT_VEC4:case d.BOOL_VEC4:u=d.uniform4iv;q=f?Uint16Array:new Uint16Array(4);break;case d.FLOAT_MAT2:j=true;u=d.uniformMatrix2fv;break;case d.FLOAT_MAT3:j=true;u=d.uniformMatrix3fv;break;case d.FLOAT_MAT4:j=true;u=d.uniformMatrix4fv}u=u.bind(d);return f&&q?function(w){u(i,new q(w))}:j?function(w){u(i,false,w.toFloat32Array())}:q?function(w){q.set(w.toFloat32Array?w.toFloat32Array():w);u(i,q)}:function(w){u(i,w)};throw"Unknown type: "+h;},
e=function(d,h,c){this.app=d;d=d.gl;var f=d.createProgram();d.attachShader(f,x(d,h,d.VERTEX_SHADER));d.attachShader(f,x(d,c,d.FRAGMENT_SHADER));d.linkProgram(f);if(!d.getProgramParameter(f,d.LINK_STATUS))throw"Error linking the shader: "+d.getProgramInfoLog(f);if(!f)return false;h={};c={};for(var i,j,r=d.getProgramParameter(f,d.ACTIVE_ATTRIBUTES),u=0;u<r;u++){i=d.getActiveAttrib(f,u);j=i.name;i=d.getAttribLocation(f,i.name);h[j]=i}r=d.getProgramParameter(f,d.ACTIVE_UNIFORMS);for(u=0;u<r;u++){i=d.getActiveUniform(f,
u);j=i.name;j=j[j.length-1]=="]"?j.substr(0,j.length-3):j;c[j]=k(d,f,i,i.name!=j)}this.program=f;this.attributes=h;this.attributeEnabled={};this.uniforms=c};e.prototype={$$family:"program",setUniform:function(d,h){if(this.uniforms[d])this.uniforms[d](h);return this},setUniforms:function(d){for(var h in d)this.setUniform(h,d[h]);return this}};["setBuffer","setBuffers","use"].forEach(function(d){e.prototype[d]=function(){var h=Array.prototype.slice.call(arguments);h.unshift(this);this.app[d].apply(this.app,
h);return this}});["setFrameBuffer","setFrameBuffers","setRenderBuffer","setRenderBuffers","setTexture","setTextures"].forEach(function(d){e.prototype[d]=function(){this.app[d].apply(this.app,arguments);return this}});e.fromShaderIds=function(d){d=z(arguments);var h=v(d.vs),c=v(d.fs);return n(d.app.gl,d.path,h.innerHTML,function(f){return n(d.app.gl,d.path,c.innerHTML,function(i){d.onSuccess(new e(d.app,f,i),d)})})};e.fromShaderSources=function(d){d=z(arguments,{path:"./"});return n(d.app.gl,d.path,
d.vs,function(h){return n(d.app.gl,d.path,d.fs,function(c){try{var f=new e(d.app,h,c);if(d.onSuccess)d.onSuccess(f,d);else return f}catch(i){if(d.onError)d.onError(i,d);else throw i;}})})};e.fromDefaultShaders=function(d){d=d||{};var h=d.fs||"Default",c=F.Shaders;d.vs=c.Vertex[d.vs||"Default"];d.fs=c.Fragment[h];return F.Program.fromShaderSources(d)};e.fromShaderURIs=function(d){d=v.merge({path:"",vs:"",fs:"",noCache:false,onSuccess:v.empty,onError:v.empty},d||{});var h=d.path+d.vs,c=d.path+d.fs;
(new F.IO.XHR.Group({urls:[h,c],noCache:d.noCache,onError:function(f){d.onError(f)},onComplete:function(f){try{return n(d.app.gl,h,f[0],function(j){return n(d.app.gl,c,f[1],function(r){d.vs=j;d.fs=r;return e.fromShaderSources(d)},d.onError)},d.onError)}catch(i){d.onError(i,d)}}})).send()};F.Program=e})();(function(){var z={},x=function(k){this.opt=k=v.merge({url:"http://philogljs.org/",method:"GET",async:true,noCache:false,sendAsBinary:false,responseType:false,onProgress:v.empty,onSuccess:v.empty,
onError:v.empty,onAbort:v.empty,onComplete:v.empty},k||{});this.initXHR()};x.State={};["UNINITIALIZED","LOADING","LOADED","INTERACTIVE","COMPLETED"].forEach(function(k,e){x.State[k]=e});x.prototype={initXHR:function(){var k=this.req=new XMLHttpRequest,e=this;["Progress","Error","Abort","Load"].forEach(function(d){if(k.addEventListener)k.addEventListener(d.toLowerCase(),function(h){e["handle"+d](h)},false);else k["on"+d.toLowerCase()]=function(h){e["handle"+d](h)}})},send:function(k){var e=this.req,
d=this.opt,h=d.async;if(d.noCache)d.url+=(d.url.indexOf("?")>=0?"&":"?")+v.uid();e.open(d.method,d.url,h);if(d.responseType)e.responseType=d.responseType;if(h)e.onreadystatechange=function(){if(e.readyState==x.State.COMPLETED)if(e.status==200)d.onSuccess(e.responseType?e.response:e.responseText);else d.onError(e.status)};d.sendAsBinary?e.sendAsBinary(k||d.body||null):e.send(k||d.body||null);if(!h)if(e.status==200)d.onSuccess(e.responseType?e.response:e.responseText);else d.onError(e.status)},setRequestHeader:function(k,
e){this.req.setRequestHeader(k,e);return this},handleProgress:function(k){if(k.lengthComputable)this.opt.onProgress(k,Math.round(k.loaded/k.total*100));else this.opt.onProgress(k,-1)},handleError:function(k){this.opt.onError(k)},handleAbort:function(k){this.opt.onAbort(k)},handleLoad:function(k){this.opt.onComplete(k)}};x.Group=function(k){function e(i){return function(j){--c;k.onError(j,i);if(!c)k.onComplete(f)}}function d(i){return function(j){--c;f[i]=j;k.onSuccess(j,i);if(!c)k.onComplete(f)}}
k=v.merge({urls:[],onError:v.empty,onSuccess:v.empty,onComplete:v.empty,method:"GET",async:true,noCache:false,sendAsBinary:false,responseType:false},k||{});var h=v.splat(k.urls),c=h.length,f=Array(c);this.reqs=h.map(function(i,j){return new x({url:i,method:k.method,async:k.async,noCache:k.noCache,sendAsBinary:k.sendAsBinary,responseType:k.responseType,body:k.body,onError:e(j),onSuccess:d(j)})})};x.Group.prototype={send:function(){for(var k=0,e=this.reqs,d=e.length;k<d;++k)e[k].send()}};var m=function(k){k=
v.merge({url:"http://philogljs.org/",data:{},noCache:false,onComplete:v.empty,callbackKey:"callback"},k||{});var e=m.counter++,d=[],h;for(h in k.data)d.push(h+"="+k.data[h]);d=d.join("&");if(k.noCache)d+=(d.indexOf("?")>=0?"&":"?")+v.uid();d=k.url+(k.url.indexOf("?")>-1?"&":"?")+k.callbackKey+"=PhiloGL.IO.JSONP.requests.request_"+e+(d.length>0?"&"+d:"");var c=document.createElement("script");c.type="text/javascript";c.src=d;m.requests["request_"+e]=function(f){k.onComplete(f);c.parentNode&&c.parentNode.removeChild(c);
c.clearAttributes&&c.clearAttributes()};document.getElementsByTagName("head")[0].appendChild(c)};m.counter=0;m.requests={};var n=function(k){k=v.merge({src:[],noCache:false,onProgress:v.empty,onComplete:v.empty},k||{});var e=0,d=k.src.length,h=function(){k.onProgress(Math.round(++e/d*100));if(e==d)k.onComplete(j)},c=function(){if(++e==d)k.onComplete(j)},f=k.noCache,i=v.uid(),j=k.src.map(function(r,u){var q=new Image;q.index=u;q.onload=h;q.onerror=c;q.src=r+(f?(r.indexOf("?")>=0?"&":"?")+i:"");return q});
return j};z.XHR=x;z.JSONP=m;z.Images=n;z.Textures=function(k,e){e=v.merge({src:[],noCache:false,onComplete:v.empty},e||{});n({src:e.src,noCache:e.noCache,onComplete:function(d){var h={};d.forEach(function(c,f){h[e.id&&e.id[f]||e.src&&e.src[f]]=v.merge({data:{value:c}},e)});k.setTextures(h);e.onComplete()}})};F.IO=z})();(function(){var z=F.Vec3,x=F.Mat4,m=function(n,k,e,d,h){h=h||{};var c=h.position,f=h.target,i=h.up;this.type=h.type?h.type:"perspective";this.fov=n;this.near=e;this.far=d;this.aspect=
k;this.position=c&&new z(c.x,c.y,c.z)||new z;this.target=f&&new z(f.x,f.y,f.z)||new z;this.up=i&&new z(i.x,i.y,i.z)||new z(0,1,0);if(this.type=="perspective")this.projection=(new x).perspective(n,k,e,d);else{n=e*Math.tan(n*Math.PI/360);h=-n;this.projection=(new x).ortho(h*k,n*k,h,n,e,d)}this.view=new x};m.prototype={update:function(){if(this.type=="perspective")this.projection=(new x).perspective(this.fov,this.aspect,this.near,this.far);else{var n=this.near*Math.tan(this.fov*Math.PI/360),k=-n,e=k*
this.aspect,d=n*this.aspect;this.projection=(new x).ortho(e,d,k,n,this.near,this.far)}this.view.lookAt(this.position,this.target,this.up)},setStatus:function(n){var k=this.position,e=this.view,d=this.projection,h=e.mulMat4(d),c=h.invert();n.setUniforms({cameraPosition:[k.x,k.y,k.z],projectionMatrix:d,viewMatrix:e,viewProjectionMatrix:h,viewInverseMatrix:e.invert(),viewProjectionInverseMatrix:c})}};F.Camera=m})();(function(){function z(c,f){if(c&&c.length<f){for(var i=c[0],j=c[1],r=c[2],u=c[3],q=[i,
j,r,u],w=f/c.length,a;--w;){a=w*4;q[a]=i;q[a+1]=j;q[a+2]=r;q[a+3]=u}return new Float32Array(q)}else return c}var x=F.Vec3,m=F.Mat4,n=Math.cos,k=Math.sin,e=Math.PI,d=Array.prototype.slice,h={attributeMap:{position:"vertices",normal:"normals",pickingColor:"pickingColors",colors:"color"}};h.Model=function(c){c=c||{};this.id=c.id||v.uid();this.pickable=!!c.pickable;this.pick=c.pick||function(){return false};this.vertices=c.vertices;this.normals=c.normals;this.textures=c.textures&&v.splat(c.textures);
this.colors=c.colors;this.indices=c.indices;this.shininess=c.shininess||0;this.reflection=c.reflection||0;this.refraction=c.refraction||0;if(c.pickingColors)this.pickingColors=c.pickingColors;if(c.texCoords)this.texCoords=c.texCoords;this.uniforms=c.uniforms||{};this.attributes=c.attributes||{};this.render=c.render;this.drawType=c.hasOwnProperty("drawType")?c.drawType:"TRIANGLES";this.display="display"in c?c.display:true;this.onBeforeRender=c.onBeforeRender||v.empty;this.onAfterRender=c.onAfterRender||
v.empty;if(c.program)this.program=c.program;this.position=new x;this.rotation=new x;this.scale=new x(1,1,1);this.matrix=new m;c.computeCentroids&&this.computeCentroids();c.computeNormals&&this.computeNormals()};h.Model.prototype=Object.create(null,{hash:{get:function(){return this.id+" "+this.$pickingIndex}},vertices:{set:function(c){if(c){var f=c.length;if(c.BYTES_PER_ELEMENT)this.$vertices=c;else if(this.$verticesLength==f)this.$vertices.set(c);else this.$vertices=new Float32Array(c);this.$verticesLength=
f}else{delete this.$vertices;delete this.$verticesLength}},get:function(){return this.$vertices}},normals:{set:function(c){if(c){var f=c.length;if(c.BYTES_PER_ELEMENT)this.$normals=c;else if(this.$normalsLength==f)this.$normals.set(c);else this.$normals=new Float32Array(c);this.$normalsLength=f}else{delete this.$normals;delete this.$normalsLength}},get:function(){return this.$normals}},colors:{set:function(c){if(c){var f=c.length;if(c.BYTES_PER_ELEMENT)this.$colors=c;else if(this.$colorsLength==f)this.$colors.set(c);
else this.$colors=new Float32Array(c);if(this.$vertices&&this.$verticesLength/3*4!=f)this.$colors=z(d.call(this.$colors),this.$verticesLength/3*4);this.$colorsLength=this.$colors.length}else{delete this.$colors;delete this.$colorsLength}},get:function(){return this.$colors}},pickingColors:{set:function(c){if(c){var f=c.length;if(c.BYTES_PER_ELEMENT)this.$pickingColors=c;else if(this.$pickingColorsLength==f)this.$pickingColors.set(c);else this.$pickingColors=new Float32Array(c);if(this.$vertices&&
this.$verticesLength/3*4!=f)this.$pickingColors=z(d.call(this.$pickingColors),this.$verticesLength/3*4);this.$pickingColorsLength=this.$pickingColors.length}else{delete this.$pickingColors;delete this.$pickingColorsLength}},get:function(){return this.$pickingColors}},texCoords:{set:function(c){if(c)if(v.type(c)=="object"){var f={},i;for(i in c){var j=c[i];f[i]=j.BYTES_PER_ELEMENT?j:new Float32Array(j)}this.$texCoords=f}else{f=c.length;if(c.BYTES_PER_ELEMENT)this.$texCoords=c;else if(this.$texCoordsLength==
f)this.$texCoords.set(c);else this.$texCoords=new Float32Array(c);this.$texCoordsLength=f}else{delete this.$texCoords;delete this.$texCoordsLength}},get:function(){return this.$texCoords}},indices:{set:function(c){if(c){var f=c.length;if(c.BYTES_PER_ELEMENT)this.$indices=c;else if(this.$indicesLength==f)this.$indices.set(c);else this.$indices=new Uint16Array(c);this.$indicesLength=f}else{delete this.$indices;delete this.$indicesLength}},get:function(){return this.$indices}}});v.extend(h.Model.prototype,
{$$family:"model",update:function(){var c=this.matrix,f=this.position,i=this.rotation,j=this.scale;c.id();c.$translate(f.x,f.y,f.z);c.$rotateXYZ(i.x,i.y,i.z);c.$scale(j.x,j.y,j.z)},computeCentroids:function(){var c=this.vertices,f=[];this.faces.forEach(function(i){var j=[0,0,0],r=0;i.forEach(function(u){u=c[u];j[0]+=u[0];j[1]+=u[1];j[2]+=u[2];r++});j[0]/=r;j[1]/=r;j[2]/=r;f.push(j)});this.centroids=f},computeNormals:function(){var c=this.vertices,f=[];this.faces.forEach(function(i){var j=c[i[0]],
r=c[i[1]];i=c[i[2]];j={x:j[0]-r[0],y:j[1]-r[1],z:j[2]-r[2]};x.$cross(j,{x:i[0]-r[0],y:i[1]-r[1],z:i[1]-r[2]});x.norm(j)>1.0E-6&&x.unit(j);f.push([j.x,j.y,j.z])});this.normals=f}});v.extend(h.Model.prototype,{setUniforms:function(c){c.setUniforms(this.uniforms)},setAttributes:function(c){var f=this.attributes,i;for(i in f){var j=f[i],r=this.id+"-"+i;if(Object.keys(j).length){j.attribute=i;c.setBuffer(r,j);delete j.value}else c.setBuffer(r,true)}},setVertices:function(c){if(this.$vertices)this.dynamic?
c.setBuffer("position-"+this.id,{attribute:"position",value:this.$vertices,size:3}):c.setBuffer("position-"+this.id)},setNormals:function(c){if(this.$normals)this.dynamic?c.setBuffer("normal-"+this.id,{attribute:"normal",value:this.$normals,size:3}):c.setBuffer("normal-"+this.id)},setIndices:function(c){if(this.$indices){var f=c.app.gl;this.dynamic?c.setBuffer("indices-"+this.id,{bufferType:f.ELEMENT_ARRAY_BUFFER,drawType:f.STATIC_DRAW,value:this.$indices,size:1}):c.setBuffer("indices-"+this.id)}},
setPickingColors:function(c){if(this.$pickingColors)this.dynamic?c.setBuffer("pickingColor-"+this.id,{attribute:"pickingColor",value:this.$pickingColors,size:4}):c.setBuffer("pickingColor-"+this.id)},setColors:function(c){if(this.$colors)this.dynamic?c.setBuffer("color-"+this.id,{attribute:"color",value:this.$colors,size:4}):c.setBuffer("color-"+this.id)},setTexCoords:function(c){if(this.$texCoords){var f=this.id,i,j,r,u;if(this.dynamic)if(v.type(this.$texCoords)=="object"){i=0;j=this.textures;for(r=
j.length;i<r;i++){u=j[i];c.setBuffer("texCoord-"+i+"-"+f,{attribute:"texCoord"+(i+1),value:this.$texCoords[u],size:2})}}else c.setBuffer("texCoord-"+f,{attribute:"texCoord1",value:this.$texCoords,size:2});else if(v.type(this.$texCoords)=="object"){i=0;j=this.textures;for(r=j.length;i<r;i++)c.setBuffer("texCoord-"+i+"-"+f)}else c.setBuffer("texCoord-"+f)}},setTextures:function(c){var f=c.app.gl;this.textures=this.textures?v.splat(this.textures):[];for(var i=0,j=0,r=0,u=this.textures,q=u.length,w=F.Scene.MAX_TEXTURES;r<
w;r++)if(r<q)if(c.app.textureMemo[u[r]].isCube){c.setUniform("hasTextureCube"+(r+1),true);c.setTexture(u[r],f["TEXTURE"+r]);c.setUniform("samplerCube"+(j+1),r);j++}else{c.setUniform("hasTexture"+(r+1),true);c.setTexture(u[r],f["TEXTURE"+r]);c.setUniform("sampler"+(i+1),r);i++}else{c.setUniform("hasTextureCube"+(r+1),false);c.setUniform("hasTexture"+(r+1),false);c.setUniform("sampler"+ ++i,r);c.setUniform("samplerCube"+ ++j,r)}},setState:function(c){c.use();this.setUniforms(c);this.setAttributes(c);
this.setVertices(c);this.setColors(c);this.setPickingColors(c);this.setNormals(c);this.setTextures(c);this.setTexCoords(c);this.setIndices(c)},unsetState:function(c){var f=c.app.gl;c=c.attributes;f.bindBuffer(f.ARRAY_BUFFER,null);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,null);for(var i in c)f.disableVertexAttribArray(c[i])}});h.Cube=function(c){h.Model.call(this,v.extend({vertices:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,
-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],texCoords:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},c||{}))};h.Cube.prototype=Object.create(h.Model.prototype);h.Sphere=
function(c){var f=c.nlat||10,i=c.nlong||10,j=c.radius||1,r=e-0,u=2*e-0,q=(f+1)*(i+1),w=new Float32Array(q*3),a=new Float32Array(q*3);q=new Float32Array(q*2);var b=new Uint16Array(f*i*6);if(typeof j=="number"){var g=j;j=function(){return g}}for(var o=0;o<=f;o++)for(var p=0;p<=i;p++){var s=p/i,t=o/f,y=u*s,A=r*t,B=k(y);y=n(y);var C=k(A),D=n(A);A=y*C;y=D;B*=C;C=j(A,y,B,s,t);D=p+o*(i+1);var G=D*3;D*=2;w[G+0]=C*A;w[G+1]=C*y;w[G+2]=C*B;a[G+0]=A;a[G+1]=y;a[G+2]=B;q[D+0]=s;q[D+1]=t}j=f+1;for(p=0;p<f;p++)for(o=
0;o<i;o++){D=(p*i+o)*6;b[D+0]=o*j+p;b[D+1]=o*j+p+1;b[D+2]=(o+1)*j+p;b[D+3]=(o+1)*j+p;b[D+4]=o*j+p+1;b[D+5]=(o+1)*j+p+1}h.Model.call(this,v.extend({vertices:w,indices:b,normals:a,texCoords:q},c||{}))};h.Sphere.prototype=Object.create(h.Model.prototype);h.IcoSphere=function(c){var f=c.iterations||0,i=[],j=[],r=Math.sqrt,u=Math.acos,q=Math.atan2,w=Math.PI,a=w*2;c.onAddVertex=c.onAddVertex||v.empty;var b=(1+r(5))/2;r(1+b*b);i.push(-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0);j.push(3,4,5,3,5,1,3,1,0,3,0,4,
4,0,2,4,2,5,2,0,1,5,2,1);var g=function(){var V={};return function(S,T){S*=3;T*=3;var W=(S<T?S:T)+"|"+(S>T?S:T);if(W in V)return V[W];var U=(i[S]+i[T])/2,N=(i[S+1]+i[T+1])/2,X=(i[S+2]+i[T+2])/2,Y=r(U*U+N*N+X*X);U/=Y;N/=Y;X/=Y;i.push(U,N,X);return V[W]=i.length/3-1}}();for(b=0;b<f;b++){for(var o=[],p=0,s=j.length;p<s;p+=3){var t=g(j[p],j[p+1]),y=g(j[p+1],j[p+2]),A=g(j[p+2],j[p]);o.push(A,j[p],t,t,j[p+1],y,y,j[p+2],A,t,y,A)}j=o}s=j.length;f=Array(s*3);g=Array(s*2);for(b=s-3;b>=0;b-=3){t=j[b];y=j[b+
1];A=j[b+2];s=t*3;o=y*3;p=A*3;t*=2;y*=2;A*=2;var B=i[s],C=i[s+1],D=i[s+2],G=u(D/r(B*B+C*C+D*D)),H=q(C,B)+w;G/=w;H=1-H/a;var K=i[o],I=i[o+1],E=i[o+2],M=u(E/r(K*K+I*I+E*E)),J=q(I,K)+w;M/=w;J=1-J/a;var L=i[p],O=i[p+1],P=i[p+2],R=u(P/r(L*L+O*O+P*P)),Q=q(O,L)+w;R/=w;Q=1-Q/a;B=x.cross([L-K,O-I,P-E],[B-K,C-I,D-E]).$unit();if((H==0||J==0||Q==0)&&(H==0||H>0.5)&&(J==0||J>0.5)&&(Q==0||Q>0.5)){i.push(i[s],i[s+1],i[s+2]);C=i.length/3-1;j.push(C);g[C*2]=1;g[C*2+1]=G;f[C*3]=B.x;f[C*3+1]=B.y;f[C*3+2]=B.z;i.push(i[o],
i[o+1],i[o+2]);C=i.length/3-1;j.push(C);g[C*2]=1;g[C*2+1]=M;f[C*3]=B.x;f[C*3+1]=B.y;f[C*3+2]=B.z;i.push(i[p],i[p+1],i[p+2]);C=i.length/3-1;j.push(C);g[C*2]=1;g[C*2+1]=R;f[C*3]=B.x;f[C*3+1]=B.y;f[C*3+2]=B.z}f[s]=f[o]=f[p]=B.x;f[s+1]=f[o+1]=f[p+1]=B.y;f[s+2]=f[o+2]=f[p+2]=B.z;g[t]=H;g[t+1]=G;g[y]=J;g[y+1]=M;g[A]=Q;g[A+1]=R}h.Model.call(this,v.extend({vertices:i,indices:j,normals:f,texCoords:g},c||{}))};h.IcoSphere.prototype=Object.create(h.Model.prototype);h.TruncatedCone=function(c){var f=c.bottomRadius||
0,i=c.topRadius||0,j=c.height||1,r=c.nradial||10,u=c.nvertical||10,q=!!c.topCap,w=!!c.bottomCap,a=(q?2:0)+(w?2:0),b=(r+1)*(u+1+a),g=new Float32Array(b*3),o=new Float32Array(b*3);b=new Float32Array(b*2);var p=new Uint16Array(r*(u+a)*6),s=r+1,t=Math,y=t.atan2(f-i,j),A=t.sin,B=t.cos;t=t.PI;var C=B(y);y=A(y);w=u+(w?2:0);var D=0,G=0;for(q=q?-2:0;q<=w;q++){var H=q/u,K=j*H,I;if(q<0){K=0;H=1;I=f}else if(q>u){K=j;H=1;I=i}else I=f+(i-f)*(q/u);if(q==-2||q==u+2)H=I=0;K-=j/2;for(var E=0;E<s;E++){var M=A(E*t*2/
r),J=B(E*t*2/r);g[D+0]=M*I;g[D+1]=K;g[D+2]=J*I;o[D+0]=q<0||q>u?0:M*C;o[D+1]=q<0?-1:q>u?1:y;o[D+2]=q<0||q>u?0:J*C;b[G+0]=E/r;b[G+1]=H;G+=2;D+=3}}for(q=0;q<u+a;q++)for(E=0;E<r;E++){f=(q*r+E)*6;p[f+0]=s*(q+0)+0+E;p[f+1]=s*(q+0)+1+E;p[f+2]=s*(q+1)+1+E;p[f+3]=s*(q+0)+0+E;p[f+4]=s*(q+1)+1+E;p[f+5]=s*(q+1)+0+E}h.Model.call(this,v.extend({vertices:g,normals:o,texCoords:b,indices:p},c||{}))};h.TruncatedCone.prototype=Object.create(h.Model.prototype);h.Cone=function(c){c.topRadius=0;c.topCap=!!c.cap;c.bottomCap=
!!c.cap;c.bottomRadius=c.radius||3;h.TruncatedCone.call(this,c)};h.Cone.prototype=Object.create(h.TruncatedCone.prototype);h.Cylinder=function(c){c.bottomRadius=c.radius;c.topRadius=c.radius;h.TruncatedCone.call(this,c)};h.Cylinder.prototype=Object.create(h.TruncatedCone.prototype);h.Plane=function(c){var f=c.type,i=f.split(","),j=c[i[0]+"len"],r=c[i[1]+"len"],u=c["n"+i[0]]||1,q=c["n"+i[1]]||1,w=c.offset,a=!!c.flipCull,b=(u+1)*(q+1);i=new Float32Array(b*3);var g=new Float32Array(b*3);b=new Float32Array(b*
2);var o=0,p=0;if(a)j=-j;for(var s=0;s<=q;s++)for(var t=0;t<=u;t++){var y=t/u,A=s/q;b[o+0]=a?1-y:y;b[o+1]=A;o+=2;switch(f){case "x,y":i[p+0]=j*y-j*0.5;i[p+1]=r*A-r*0.5;i[p+2]=w;g[p+0]=0;g[p+1]=0;g[p+2]=a?1:-1;break;case "x,z":i[p+0]=j*y-j*0.5;i[p+1]=w;i[p+2]=r*A-r*0.5;g[p+0]=0;g[p+1]=a?1:-1;g[p+2]=0;break;case "y,z":i[p+0]=w;i[p+1]=j*y-j*0.5;i[p+2]=r*A-r*0.5;g[p+0]=a?1:-1;g[p+1]=0;g[p+2]=0}p+=3}r=u+1;f=[];for(s=0;s<q;s++)for(t=0;t<u;t++){j=(s*u+t)*6;f[j+0]=(s+0)*r+t;f[j+1]=(s+1)*r+t;f[j+2]=(s+0)*
r+t+1;f[j+3]=(s+1)*r+t;f[j+4]=(s+1)*r+t+1;f[j+5]=(s+0)*r+t+1}if(c.unpack){u=new Float32Array(f.length*3);q=new Float32Array(f.length*3);s=new Float32Array(f.length*2);t=0;for(l=f.length;t<l;++t){j=f[t];u[t*3]=i[j*3];u[t*3+1]=i[j*3+1];u[t*3+2]=i[j*3+2];q[t*3]=g[j*3];q[t*3+1]=g[j*3+1];q[t*3+2]=g[j*3+2];s[t*2]=b[j*2];s[t*2+1]=b[j*2+1]}h.Model.call(this,v.extend({vertices:u,normals:q,texCoords:s},c))}else h.Model.call(this,v.extend({vertices:i,normals:g,texCoords:b,indices:f},c))};h.Plane.prototype=Object.create(h.Model.prototype);
h.id=v.time();F.O3D=h})();(function(){var z={Vertex:{},Fragment:{}},x=z.Fragment;z.Vertex.Default="#define LIGHT_MAX 4\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec4 pickingColor;\nattribute vec2 texCoord1;\nuniform mat4 viewMatrix;\nuniform mat4 viewInverseMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform mat4 worldInverseMatrix;\nuniform mat4 worldInverseTransposeMatrix;\nuniform mat4 objectMatrix;\nuniform vec3 cameraPosition;\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\nuniform bool useReflection;\nvarying vec3 vReflection;\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec4 vNormal;\nvarying vec3 lightWeighting;\nvoid main(void) {\nvec4 mvPosition = worldMatrix * vec4(position, 1.0);\nvec4 transformedNormal = worldInverseTransposeMatrix * vec4(normal, 1.0);\nif(!enableLights) {\nlightWeighting = vec3(1.0, 1.0, 1.0);\n} else {\nvec3 plightDirection;\nvec3 pointWeight = vec3(0.0, 0.0, 0.0);\nfloat directionalLightWeighting = max(dot(transformedNormal.xyz, lightingDirection), 0.0);\nfor (int i = 0; i < LIGHT_MAX; i++) {\nif (i < numberPoints) {\nplightDirection = normalize((viewMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\npointWeight += max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n} else {\nbreak;\n}\n}\nlightWeighting = ambientColor + (directionalColor * directionalLightWeighting) + pointWeight;\n}\nif (useReflection) {\nvReflection = (viewInverseMatrix[3] - (worldMatrix * vec4(position, 1.0))).xyz;\n} else {\nvReflection = vec3(1.0, 1.0, 1.0);\n}\nvColor = color;\nvPickingColor = pickingColor;\nvTexCoord = texCoord1;\nvNormal = transformedNormal;\ngl_Position = projectionMatrix * worldMatrix * vec4(position, 1.0);\n}";
x.Default="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvarying vec3 vReflection;\nvarying vec4 vNormal;\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool hasTextureCube1;\nuniform samplerCube samplerCube1;\nuniform bool enablePicking;\nuniform bool hasPickingColors;\nuniform vec3 pickColor;\nuniform float reflection;\nuniform float refraction;\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvoid main(){\nif (!hasTexture1) {\ngl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n} else {\ngl_FragColor = vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb * lightWeighting, 1.0);\n}\nif (hasTextureCube1) {\nvec3 nReflection = normalize(vReflection);\nvec3 reflectionValue;\nif (refraction > 0.0) {\nreflectionValue = refract(nReflection, vNormal.xyz, refraction);\n} else {\nreflectionValue = -reflect(nReflection, vNormal.xyz);\n}\nvec4 cubeColor = textureCube(samplerCube1, vec3(-reflectionValue.x, -reflectionValue.y, reflectionValue.z));\ngl_FragColor = vec4(mix(gl_FragColor.xyz, cubeColor.xyz, reflection), 1.0);\n}\nif (enablePicking) {\nif (hasPickingColors) {\ngl_FragColor = vPickingColor;\n} else {\ngl_FragColor = vec4(pickColor, 1.0);\n}\n}\nif (hasFog) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep(fogNear, fogFar, depth);\ngl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n}\n}";
F.Shaders=z})();(function(){var z=F.Vec3,x=function(m,n,k,e){e=v.merge({lights:{enable:false,ambient:{r:0.2,g:0.2,b:0.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false}},e||{});this.app=m;this.gl=m.gl;this.program=e.program?n[e.program]:n;this.camera=k;this.models=[];this.config=e};x.prototype={add:function(){for(var m=0,n=this.models,k=arguments.length;m<k;m++){var e=arguments[m];e.id=e.id||v.uid();n.push(e);this.defineBuffers(e)}},remove:function(m){var n=this.models;
m=n.indexOf(m);m>-1&&n.splice(m,1)},getProgram:function(m){var n=this.program;if(n.$$family!="program"&&m&&m.program){n=n[m.program];n.use()}return n},defineBuffers:function(m){var n=this.getProgram(m),k=m.dynamic;m.dynamic=true;m.setState(n);m.dynamic=k;m.unsetState(n)},beforeRender:function(m){this.setupLighting(m);this.setupEffects(m);this.camera&&this.camera.setStatus(m)},setupLighting:function(m){var n=this.config.lights,k=n.ambient,e=n.directional,d=e.color,h=e.direction,c=n.enable;n=n.points&&
v.splat(n.points)||[];e=n.length;var f=[],i=[],j=[],r=[];h=(new z(h.x,h.y,h.z)).$unit().$scale(-1);m.setUniform("enableLights",c);if(c){m.setUniform("ambientColor",[k.r,k.g,k.b]);m.setUniform("directionalColor",[d.r,d.g,d.b]);m.setUniform("lightingDirection",[h.x,h.y,h.z]);m.setUniform("numberPoints",e);for(k=0;k<e;k++){c=n[k];d=c.position;h=c.color||c.diffuse;c=c.specular;f.push(d.x,d.y,d.z);i.push(h.r,h.g,h.b);j.push(+!!c);c?r.push(c.r,c.g,c.b):r.push(0,0,0)}if(f.length){m.setUniforms({pointLocation:f,
pointColor:i});m.setUniforms({enableSpecular:j,pointSpecularColor:r})}}},setupEffects:function(m){var n=this.config.effects.fog,k=n.color||{r:0.5,g:0.5,b:0.5};n?m.setUniforms({hasFog:true,fogNear:n.near,fogFar:n.far,fogColor:[k.r,k.g,k.b]}):m.setUniform("hasFog",false)},render:function(m){m=m||{};var n=this.camera,k=this.program,e=m.renderProgram,d=v.type(k);d=!e&&d=="object";m=v.extend({onBeforeRender:v.empty,onAfterRender:v.empty},m||{});!d&&this.beforeRender(e||k);for(var h=0,c=this.models,f=c.length;h<
f;++h){var i=c[h];if(i.display){k=e||this.getProgram(i);d&&this.beforeRender(k);i.onBeforeRender(k,n);m.onBeforeRender(i,h);this.renderObject(i,k);m.onAfterRender(i,h);i.onAfterRender(k,n)}}},renderToTexture:function(m,n){n=n||{};var k=this.app.textures[m+"-texture"],e=this.app.textureMemo[m+"-texture"];this.render(n);this.gl.bindTexture(e.textureType,k)},renderObject:function(m,n){var k=this.camera,e=m.matrix,d=k.view.mulMat4(e),h=d.invert(),c=h.transpose();m.setState(n);n.setUniforms({objectMatrix:e,
worldMatrix:d,worldInverseMatrix:h,worldInverseTransposeMatrix:c});if(m.render)m.render(this.gl,n,k);else m.$indicesLength?this.gl.drawElements(m.drawType!==undefined?this.gl.get(m.drawType):this.gl.TRIANGLES,m.$indicesLength,this.gl.UNSIGNED_SHORT,0):this.gl.drawArrays(m.drawType!==undefined?this.gl.get(m.drawType):this.gl.TRIANGLES,0,m.$verticesLength/3);m.unsetState(n)},setupPicking:function(m){var n=F.Program.fromDefaultShaders({app:this.app});this.app.setFrameBuffer("$picking",{width:5,height:1,
bindToTexture:{parameters:[{name:"TEXTURE_MAG_FILTER",value:"NEAREST"},{name:"TEXTURE_MIN_FILTER",value:"NEAREST"},{name:"TEXTURE_WRAP_S",value:"CLAMP_TO_EDGE"},{name:"TEXTURE_WRAP_T",value:"CLAMP_TO_EDGE"}]},bindToRenderBuffer:true});this.app.setFrameBuffer("$picking",false);this.pickingProgram=m.pickingProgram||n},pick:function(m,n,k){k=k||{};this.pickingProgram||this.setupPicking(k);var e={},d=[],h=this.app.usedProgram,c=this.pickingProgram,f=this.camera,i=f.target,j=f.aspect,r=this.config,u=r.lights.enable,
q=r.effects.fog,w=this.gl.canvas,a=k.viewport||{},b=k.pixelRatio||1;k=a.width||w.offsetWidth||w.width;w=a.height||w.offsetHeight||w.height;n=this.unproject([(m*b-(a.x||0))*2/k-1,1-(n*b-(a.y||0))*2/w,1],f);m=new Uint8Array(4);this.camera.target=n;this.camera.update();r.lights.enable=false;r.effects.fog=false;this.app.setFrameBuffer("$picking",true);c.use();c.setUniform("enablePicking",true);this.gl.disable(this.gl.BLEND);this.gl.viewport(0,0,5,1);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);
this.gl.readPixels(0,0,1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,m);this.renderPickingScene({background:m[0]+m[1]*256+m[2]*65536,o3dHash:e,o3dList:d,hash:[]});this.gl.readPixels(2,0,1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,m);n=[m[0],m[1],m[2]].join();n=e[n];if(!n)for(var g=0,o=d.length;g<o;g++){n=d[g];b=n.pick(m);if(b!==false)n.$pickingIndex=b;else n=false}this.app.setFrameBuffer("$picking",false);this.app.setTexture("$picking-texture",false);c.use();c.setUniform("enablePicking",false);r.lights.enable=
u;r.effects.fog=q;h&&h.use();this.gl.viewport(a.x||0,a.y||0,k,w);f.target=i;f.aspect=j;f.update();this.o3dHash=e;this.o3dList=d;this.pixel=m;this.capture=void 0;return n&&n.pickable&&n},unproject:function(m,n){return n.view.invert().mulMat4(n.projection.invert()).mulVec3(m)},renderPickingScene:function(m){if(this.config.renderPickingScene)this.config.renderPickingScene.call(this,m);else{var n=this.pickingProgram,k=m.o3dHash,e=m.o3dList,d=m.background,h=m.hash,c=0;this.renderToTexture("$picking",{renderProgram:n,
onBeforeRender:function(f,i){if(i==d)c=1;var j=i+c,r=!!f.pickingColors;n.setUniform("hasPickingColors",r);if(r)e.push(f);else{h[0]=j%256;h[1]=(j/256>>0)%256;h[2]=(j/65536>>0)%256;n.setUniform("pickColor",[h[0]/255,h[1]/255,h[2]/255]);k[h.join()]=f}}})}},resetPicking:v.empty};x.MAX_TEXTURES=10;x.MAX_POINT_LIGHTS=4;x.PICKING_RES=4;F.Scene=x})();(function(){function z(x,m){for(var n=this.workers=[];m--;)n.push(new Worker(x))}z.prototype={map:function(x){var m=this.workers,n=this.configs=[],k=0;for(m=
m.length;k<m;k++)n.push(x&&x(k));return this},reduce:function(x){for(var m=x.reduceFn,n=this.workers,k=this.configs,e=n.length,d=x.initialValue,h=function(j){e--;d=d===undefined?j.data:m(d,j.data);if(e==0)x.onComplete(d)},c=0,f=e;c<f;c++){var i=n[c];i.onmessage=h;i.postMessage(k[c])}return this}};F.WorkerGroup=z})();(function(){var z=function(d){this.opt=v.merge({delay:0,duration:1E3,transition:function(h){return h},onCompute:v.empty,onComplete:v.empty},d||{})},x=z.Queue=[];z.prototype={time:null,
start:function(d){this.opt=v.merge(this.opt,d||{});this.time=v.time();this.animating=true;x.push(this)},step:function(){if(this.animating){var d=v.time(),h=this.time,c=this.opt,f=c.delay,i=c.duration,j=0;if(d<h+f)c.onCompute.call(this,j);else if(d<h+f+i){j=c.transition((d-h-f)/i);c.onCompute.call(this,j)}else{this.animating=false;c.onCompute.call(this,1);c.onComplete.call(this)}}}};z.compute=function(d,h,c){return d+(h-d)*c};z.Transition={linear:function(d){return d}};var m=z.Transition;(function(){var d=
function(f,i){i=v.splat(i);return v.extend(f,{easeIn:function(j){return f(j,i)},easeOut:function(j){return 1-f(1-j,i)},easeInOut:function(j){return j<=0.5?f(2*j,i)/2:(2-f(2*(1-j),i))/2}})},h={Pow:function(f,i){return Math.pow(f,i[0]||6)},Expo:function(f){return Math.pow(2,8*(f-1))},Circ:function(f){return 1-Math.sin(Math.acos(f))},Sine:function(f){return 1-Math.sin((1-f)*Math.PI/2)},Back:function(f,i){i=i[0]||1.618;return Math.pow(f,2)*((i+1)*f-i)},Bounce:function(f){for(var i,j=0,r=1;;j+=r,r/=2)if(f>=
(7-4*j)/11){i=r*r-Math.pow((11-6*j-11*f)/4,2);break}return i},Elastic:function(f,i){return Math.pow(2,10*--f)*Math.cos(20*f*Math.PI*(i[0]||1)/3)}},c;for(c in h)m[c]=d(h[c]);["Quad","Cubic","Quart","Quint"].forEach(function(f,i){m[f]=d(function(j){return Math.pow(j,[i+2])})})})();var n=self||window,k=function(){var d=x;x=[];if(d.length){for(var h=0,c=d.length,f;h<c;h++){f=d[h];f.step();f.animating&&x.push(f)}z.Queue=x}};if(n){var e=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime",
"mozAnimationStartTime","animationStartTime"].forEach(function(d){if(d in n){z.animationTime=function(){return n[d]};e=true}});if(!e)z.animationTime=v.time;e=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(d){if(d in n){z.requestAnimationFrame=function(h){n[d](function(){k();h()})};e=true}});if(!e)z.requestAnimationFrame=function(d){setTimeout(function(){k();d()},1E3/60)}}F.Fx=z})();(function(){var z={},x=function(){};x.postProcess=function(){var m=
new F.O3D.Plane({type:"x,y",xlen:0.16568542494923805,ylen:0.16568542494923805,offset:0}),n=new F.Camera(45,1,0.1,500,{position:{x:0,y:0,z:0.2}});return function(k){var e=k.app,d=e.gl,h=new F.Scene(e,{},n),c=e.program.$$family?e.program:e.program[k.program],f=k.fromTexture?v.splat(k.fromTexture):[],i=k.toFrameBuffer,j=!!k.toScreen,r=k.width||e.canvas.width,u=k.height||e.canvas.height,q=k.viewportX||0,w=k.viewportY||0;n.aspect=k.aspectRatio?k.aspectRatio:Math.max(u/r,r/u);n.update();h.program=c;m.textures=
f;m.program=c;h.models.length||h.add(m);if(i){i in e.frameBufferMemo||e.setFrameBuffer(i,{width:r,height:u,bindToTexture:{parameters:[{name:"TEXTURE_MAG_FILTER",value:"LINEAR"},{name:"TEXTURE_MIN_FILTER",value:"LINEAR",generateMipmap:false}]},bindToRenderBuffer:false});c.use();e.setFrameBuffer(i,true);d.viewport(q,w,r,u);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);c.setUniforms(k.uniforms||{});h.renderToTexture(i);e.setFrameBuffer(i,false)}if(j){c.use();d.viewport(q,w,r,u);d.clear(d.COLOR_BUFFER_BIT|
d.DEPTH_BUFFER_BIT);c.setUniforms(k.uniforms||{});h.render()}return this}}();z.Image=x;F.Media=z})();if(typeof define==="function"&&define.amd)define(F);else if(typeof module==="object"&&module.exports)module.exports=F;this.PhiloGL=F})();
